<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projekter - Support Solutions CRM</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="main-container">
        <div class="container-fluid">
            <!-- Hero Section -->
            <div class="hero-section">
                <div class="d-flex align-items-center justify-content-center mb-3">
                    <img src="https://support-solutions.dk/wp-content/uploads/Logo-hvid-web.png" 
                         alt="Support Solutions Logo" 
                         style="height: 50px; width: auto; margin-right: 1rem;">
                    <h1 class="hero-title mb-0">
                        <i class="fas fa-project-diagram me-2"></i>Projekt Oversigt
                    </h1>
                </div>
                <p class="hero-subtitle">
                    Styr og følg alle projekter fra start til slutning
                </p>
                
                <!-- CRM Navigation -->
                <div class="crm-nav">
                    <a href="/" class="nav-btn">
                        <i class="fas fa-tachometer-alt me-1"></i> Dashboard
                    </a>
                    <a href="/customers" class="nav-btn">
                        <i class="fas fa-users me-1"></i> Kunder
                    </a>
                    <a href="/deals" class="nav-btn">
                        <i class="fas fa-handshake me-1"></i> Deals
                    </a>
                    <a href="/projects" class="nav-btn active">
                        <i class="fas fa-project-diagram me-1"></i> Projekter
                    </a>
                    <a href="/consultants" class="nav-btn">
                        <i class="fas fa-user-tie me-1"></i> Konsulenter
                    </a>
                    <a href="/activities" class="nav-btn">
                        <i class="fas fa-calendar me-1"></i> Aktiviteter
                    </a>
                </div>
            </div>

            <!-- Project Stats -->
            <div class="quick-insights">
                <div class="insight-card">
                    <div class="insight-number">{{ stats.total or 0 }}</div>
                    <div class="insight-label">Total Projekter</div>
                    <div class="insight-trend"><i class="fas fa-project-diagram"></i> Alle projekter</div>
                </div>
                <div class="insight-card">
                    <div class="insight-number">{{ stats.active or 0 }}</div>
                    <div class="insight-label">Aktive Projekter</div>
                    <div class="insight-trend"><i class="fas fa-chart-line"></i> I gang</div>
                </div>
                <div class="insight-card">
                    <div class="insight-number">{{ "%.1f"|format((stats.total_budget or 0) / 1000000) }}M</div>
                    <div class="insight-label">Total Budget</div>
                    <div class="insight-trend"><i class="fas fa-coins"></i> DKK</div>
                </div>
                <div class="insight-card">
                    <div class="insight-number">{{ "%.1f"|format((stats.avg_budget or 0) / 1000) }}K</div>
                    <div class="insight-label">Gennemsnit Budget</div>
                    <div class="insight-trend"><i class="fas fa-chart-bar"></i> Per projekt</div>
                </div>
            </div>

            <!-- Main Card -->
            <div class="glass-card">
                <div class="search-section">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h3><i class="fas fa-project-diagram me-2"></i>Alle Projekter</h3>
                        <div class="btn-group">
                            <button class="btn btn-outline-primary btn-sm active" onclick="filterProjects('all')">
                                <i class="fas fa-globe"></i> Alle
                            </button>
                            <button class="btn btn-outline-success btn-sm" onclick="filterProjects('active')">
                                <i class="fas fa-play"></i> Aktive
                            </button>
                            <button class="btn btn-outline-warning btn-sm" onclick="filterProjects('planning')">
                                <i class="fas fa-clipboard-list"></i> Planlægning
                            </button>
                            <button class="btn btn-outline-info btn-sm" onclick="filterProjects('completed')">
                                <i class="fas fa-check"></i> Færdige
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Projects Table -->
                <div class="result-section">
                    <div class="table-responsive">
                        <table class="table table-hover" id="projectTable">
                            <thead>
                                <tr>
                                    <th>Projekt Navn</th>
                                    <th>Kunde</th>
                                    <th>Status</th>
                                    <th>Budget</th>
                                    <th>Budget Forbrug</th>
                                    <th>Team</th>
                                    <th>Start Dato</th>
                                    <th>Handlinger</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for project in projects %}
                                <tr data-status="{{ project.status }}" data-customer="{{ project.customer_name or '' }}">
                                    <td>
                                        <strong>{{ project.name }}</strong>
                                        {% if project.description %}
                                        <br><small class="text-muted">{{ project.description[:50] }}...</small>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if project.customer_name %}
                                        <i class="fas fa-building me-1"></i>{{ project.customer_name }}
                                        {% else %}
                                        <span class="text-muted">Ingen kunde</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <span class="status-badge 
                                            {% if project.status == 'Completed' %}badge-active{% endif %}
                                            {% if project.status == 'In Progress' %}badge-progress{% endif %}
                                            {% if project.status == 'Planning' %}badge-planning{% endif %}
                                            {% if project.status == 'On Hold' %}badge-won{% endif %}
                                        ">{{ project.status }}</span>
                                    </td>
                                    <td>
                                        <strong>{{ "{:,.0f}".format(project.budget) }} DKK</strong>
                                    </td>
                                    <td>
                                        {% set usage_percent = ((project.actual_cost or 0) / project.budget * 100) if project.budget > 0 else 0 %}
                                        <div class="progress" style="height: 20px;">
                                            <div class="progress-bar 
                                                {% if usage_percent < 75 %}bg-success{% endif %}
                                                {% if usage_percent >= 75 and usage_percent < 90 %}bg-warning{% endif %}
                                                {% if usage_percent >= 90 %}bg-danger{% endif %}"
                                                data-width="{{ usage_percent|round(0) }}">
                                                {{ "%.0f"|format(usage_percent) }}%
                                            </div>
                                        </div>
                                        <small>{{ "{:,.0f}".format(project.actual_cost or 0) }} / {{ "{:,.0f}".format(project.budget) }} DKK</small>
                                    </td>
                                    <td>
                                        <span class="badge bg-info">{{ project.consultant_count or 0 }}</span>
                                        {% if project.consultant_names %}
                                        <br><small>{{ project.consultant_names }}</small>
                                        {% endif %}
                                    </td>
                                    <td>{{ project.start_date or 'Ikke sat' }}</td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <a href="/project/{{ project.id }}" class="btn btn-outline-primary">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                            <button class="btn btn-outline-info" data-project-id="{{ project.id }}" onclick="viewProjectTeam(this.dataset.projectId)">
                                                <i class="fas fa-users"></i>
                                            </button>
                                            <button class="btn btn-outline-success" data-project-id="{{ project.id }}" onclick="updateProgress(this.dataset.projectId)">
                                                <i class="fas fa-tasks"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function filterProjects(type) {
            const rows = document.querySelectorAll('#projectTable tbody tr');
            
            // Update button states
            document.querySelectorAll('.btn-group .btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            rows.forEach(row => {
                const status = row.dataset.status;
                
                switch(type) {
                    case 'all':
                        row.style.display = '';
                        break;
                    case 'active':
                        row.style.display = status === 'In Progress' ? '' : 'none';
                        break;
                    case 'planning':
                        row.style.display = status === 'Planning' ? '' : 'none';
                        break;
                    case 'completed':
                        row.style.display = status === 'Completed' ? '' : 'none';
                        break;
                }
            });
        }
        
        // Set progress bar widths from data attributes
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('[data-width]').forEach(function(element) {
                const width = element.getAttribute('data-width');
                element.style.width = width + '%';
            });
        });
        
        function viewProjectTeam(projectId) {
            alert('Viser projektteam for projekt ID: ' + projectId);
        }
        
        function updateProgress(projectId) {
            alert('Opdaterer fremskridt for projekt ID: ' + projectId);
        }
    </script>
</body>
</html>